pampero
=======

Manages the process of software unattended installations and deployment.

_Note: this is a work in progress_

What is it?
-----------

PAMPERO is a bunch of scripts (mainly `PHP` scripts) designed to maintain and manage unattended installation of differents kind of _applications_. It provides a console based interface in order to perform basic actions such as:

* `list`
* `install`
* `add` _( not supported yet )_
* `remove` _( not supported yet )_

By _application_ we understand any scriptable code that could be run in the native computer that it's intended to be installed. PAMPERO pretends to be cross-platform, but that depends on the level of extention we can reach, i.e., if the required scripts are written.

As a scriptable code example, I'll point the following windows-batch code, stored in example.bat:

    @echo off
    echo %1 %2

The file `example.bat` is accompanied by a `manifest.json` file that has information about the package. For example:

    {
    "someName": [
           {
                 "id": "someName-1.2.i686",
                 "installer": <server_share>\<packageSomeName>\someName.bat,
                 "installerArg": "arg1 \"arg2 with spaces\"",
                 "arc": "i686",
                 "os": [ "Windows 7", "Windows XP" ],
                 "version": "1.2",
                 "name": "someName",
                 "description": "some description"
            }
     ]
    }

Of course this should be autogenerated based on the add package procedure but it's good to know it. Note that, more than one object is permitted for the package `someName` and that's why `PAMPERO` is mainly thought with cross-platform in mind. Together, `installer` and `installerArgs` will be invoked by the correspondent shell for the native target system.

As the writting of this readme, the manifest file has the following format:

    {
        "<packageName>": [ <packageObject1>, <packageObject2>, ... ]
    }

Where `<packageName>` will be the package name without spaces. <packageObjectN> has the following form:

    {
        "id": "<autoGenerated>",
        "installer": "<installerPath>",
        "installerArgs": "<args>",
        "arch": "<packageArchitecure>",
        "os": <osArrayList>,
        "version": "<packageVersion>",
        "name": "<packageName>",
         "description": "<packageDescription>"
    }

Command-line usage:
-------------------

_NOTE: As the writting of this file, only windows batch files are written and no cross-platform scripts are available._

This section contains platform-dependent sections. You can invoke `PHP` scripts using just `PHP` tools or use platform-dependent provided scripts. PAMPERO will contain scripts in order to execute any of the actions listing above from command line. Despite of being capable of running `PHP` scripts manually - _that in fact, invocation scripts are just wrappers of this_ - shell scripts are made available in order to be a system that could be handled by a sysadmin. The main reason is if some target machine is not able to access the site and do it by itself. Then, a sysadmin user could use the command line interface in order to complete the request for a target system.

It's preferable that end-users point their browsers to the site and select the package they want to install, but, as a fallback mode, sysadmin could perform such action via preferred shell.

### Listing

Listing is done via the `list.php` module located inside `php/modules` directory. `list.php` will list all available packages that follows a specific file structure under `PACKAGES_DIR/<package>` directory. Inside those directories, a `manifest.json` file **must** exists in order to retrieve and detect package data.

`list.php` will accept any `<packageObject>` object property as argument. Thus, `list.php` will filter the data upon object properties. It will also contain filter options, such as `exact` for exact match, and, output options as `full` that will list each package property instead of listing only the `id` property.

`list.php [ full={ yes|no|1|0 }] [ exact={ yes|no|1|0 } ] [ objPropertyX[]=value, ... ]`

It's adviced to invoke `list.php` throught `packages.php` file. For example:

`php-cgi -f packages.php command=list` will invoke and use the `list.php` module with any arguments you passed by, for instance, `php-cgi -f packages.php command=list full=yes name=Mozilla` will include `list.php` module and invoke the list function with the arguments `full=yes name=Mozilla`.

#### Arguments

`target=` will list only available packages based on target system information (i.e., Operating system, system architecture)
`exact=` will match package properties case sensitive
`full=` will list a full output details (console-based)
`<packageProperty>=` will filter packages with the value provided for the property

#### Windows specific

`packages.bat` script file is provided to wrap `php-cgi` calls to `packages.php` file and make life a little easier while invoking modules.
 
`packages.bat list` will wrap to `php-cgi -f packages.php command=list` and also it will manage `CSV` values for you when you want to provide a property with more than one value, for example:

`packages.bat list exact=no full=yes name=firefox,mozilla`

Will wrap to `php-cgi -f packages.php command=list name[]=mozilla name[]=firefox` and it will try to find any packages that contains *firefox* or *mozilla* in its `name` property.


##### Output Example:

    C:\pampero\admin\scripts\windows>packages.bat list output=console
    Microsoft (R) Windows Script Host versiÃ³n 5.8
    Copyright (C) Microsoft Corporation 1996-2006. Reservados todos los derechos.
    Se encontraron 3 paquete(s):

    Item 0:
    -------
             id: Nadanuevo-1.i686
    Item 1:
    -------
             id: ExampleOk-0.0.1.i686
    Item 2:
    -------
             id: ExampleError-0.0.1.i686

    Filtro utilizado:
        Ninguno

    Opciones del filtro:
        (exact => no)
        (full => no)

### Installing

`packages.bat install name=firefox target=<machine-name>` will install any package that contains "firefox" in its name property into de target machine as specified by `target=`. Implementation detail: the install command will first get a list exactly the same way if you were listing, and feed up the result to the installation script.
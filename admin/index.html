	<!DOCTYPE html>
	<html>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<head>
		<style>
		#packagesTable tbody > tr > td { 
			white-space: nowrap;
			text-overflow: ellipsis;
			overflow: hidden;
		}

		</style>
		<link rel="stylesheet" href="../css/bootstrap.css">
		<link rel="stylesheet" href="../css/bootstrap-glyphicons.css">
		<link rel="stylesheet" href="../css/DT_bootstrap.css">

		<script type="text/javascript" charset="utf-8" src="../js/jquery-dev.js"></script>
		<script type="text/javascript" charset="utf-8" src="../js/jquery.dataTables.js"></script>
		<script type="text/javascript" charset="utf-8" src="../js/TableTools.js"></script>
		<script type="text/javascript" charset="utf-8" src="../js/bootstrap.js"></script>
		<script type="text/javascript" charset="utf-8" src="../js/DT_bootstrap.js"></script>
		<script>
		var gdata;

		function getForm( data ) {
			if ( typeof( data ) === "undefined" ) { 
				data = {
					name: "",
					version: "",
					description: "",
					installerArgs: "",
					os: [],
					arch: []
				};
			}
			gdata = data;
			var html = "<form class='form-horizontal' role='form'>";
			// Name
			html += "<div class='form-group'>";
			html += "<label for='inputId' class='col-lg-3 control-label'>Nombre</label>";
			html += "<div class='col-lg-9'>";
			html += "<input value='" + data.name + "' type='text' class='form-control' id='inputId' placeholder='Nombre del programa sin espacios ni puntuaciones'>";
			html += "</div>";
			html += "</div>";
			// Description
			html += "<div class='form-group'>";
			html += "<label for='inputDescription' class='col-lg-3 control-label'>Descripción</label>";
			html += "<div class='col-lg-9'>";
			html += "<input value='" + data.description + "' type='text' class='form-control' id='inputDescription' placeholder='Descripción del programa.'>";
			html += "</div>";
			html += "</div>";
			// TABS
			html += "<div class='form-group'>";
			html += "<ul class='nav nav-tabs' id='myTab'>";
			//html += "<li class='active'><a href='#inst1' data-toggle='tab'>Instalador 1</a></li>";
			html += "<li><a class='add-tab' href='#newinst'><span class='glyphicon glyphicon-plus-sign'></span></a></li>";
			html += "</ul></div>";
			// CONTENTS
			html += "<div class='tab-content'>"
			//html += "<div class='tab-pane active' id='inst1'>"
			// Operating Systems

			// Architecture
			
			// Version
			
			// Arguments
			
			// File upload
			
			//html += "</div>";
			html += "</div>";
			// Submit
			html += "<div class='form-group'>";
			html += "<div class='col-offset-3 col-lg-9'>";
			html += "<button type='submit' class='btn btn-primary'>Enviar</button>";
			html += "</div>";
			html += "</div>";

			html += "</form>";
			return html;
		}

		function getFormOSSection( data ) {
			var html = "";
			html += "<div class='form-group'>";
			html += "<label class='col-lg-3 control-label'>Sistema Operativo</label>";
			html += "<div class='col-lg-9'>";
			// Windows 7
			html += "<div class='checkbox'>";
			html += "<label>";
			html += "<input type='checkbox' value='' " + (( data.os.indexOf( 'Windows 7' ) != -1 )? "checked": "") + ">";
			html += "Windows 7";
			html += "</label>";
			html += "</div>";
			// Windows XP
			html += "<div class='checkbox'>";
			html += "<label>";
			html += "<input type='checkbox' value='' " + (( data.os.indexOf( 'Windows XP' ) != -1 )? "checked": "") + ">";
			html += "Windows XP";
			html += "</label>";
			html += "</div>";
			// Windows 8
			html += "<div class='checkbox'>";
			html += "<label>";
			html += "<input type='checkbox' value='' " + (( data.os.indexOf( 'Windows 8' ) != -1 )? "checked": "") + ">";
			html += "Windows 8";
			html += "</label>";
			html += "</div>";
			html += "</div>";
			html += "</div>";
			return html;
		}

		function getFormArchSection( data ) {
			var html = "";
			html += "<div class='form-group'>"
			html += "<label for='arch' class='control-label col-lg-3'>Arquitectura</label>";
			html += "<div class='col-lg-9'>"
			html += "<select id='arch' class='form-control'>";
			html += "<option>i686</option>";
			html += "<option>x86_64</option>"
			html += "</select>";
			html += "</div>";
			html += "</div>";
			return html;
		}

		function getFormVersionSection( data ) {
			var html = "";
			html += "<div class='form-group'>";
			html += "<label for='inputVersion' class='col-lg-3 control-label'>Version</label>";
			html += "<div class='col-lg-9'>";
			html += "<input value='" + data.version + "' type='text' class='form-control' id='inputVersion' placeholder='Version del programa, ejemplo: 1.2.2'/>";
			html += "</div>";
			html += "</div>";
			return html;
		}

		function getFormInstallerArgsSection( data ) {
			var html = "";
			html += "<div class='form-group'>";
			html += "<label for='inputArguments' class='col-lg-3 control-label'>Argumentos</label>";
			html += "<div class='col-lg-9'>";
			html += "<input value='" + data.installerArgs + "' type='text' class='form-control' id='inputArguments' placeholder='Ejemplo: /S /norestart'/>";
			html += "</div>";
			html += "</div>";
			return html;
		}

		function getFormFileUploadSection( data ) {
			var html = "";
			html += "<div class='form-group'>"
			html += "<label for='file' class='col-lg-3 control-label'>Archivo</label>";
			html += "<div class='col-lg-9'>";
			html += "<input type='file' id='file'/>";
			html += "</div>";
			html += "</div>";
			return html;
		}

		$(document).ready( function() { 
			var packagesTable = $( '#packagesTable' ).dataTable({
				"sDom": "<'row'<'col-lg-6'T><'col-lg-6'f>r>t<'row'<'col-lg-6'><'col-lg-6'p>>",
				"sPaginationType": "bootstrap",
				"oTableTools": {
					"sRowSelect": "single",
					"aButtons": [
					{
						"sExtends": "text",
						"sButtonText": "Nuevo",
						"fnInit": function ( nButton, oConfig ) {
							var button = $( nButton );
							button.attr( 'data-toggle', 'modal' );
							button.attr( 'href', '#myModal' );
							button.addClass( 'btn' );
							button.addClass( 'btn-primary' );
						},
						"fnClick": function ( nButton, oConfig, oFlash ) {
							$( '.modal-body' ).html( getForm() );
							$( '.modal-title' ).html( 'Nuevo Software' );
						},
						"fnSelect": function ( nButton, oConfig, nRow ) {
							// row selected
						}
					},
					{
						"sExtends": "text",
						"sButtonText": "Eliminar",
						"fnInit": function ( nButton, oConfig ) {
							$( nButton ).attr( 'disabled', 'true');
						},
						"fnClick": function ( nButton, oConfig, oFlash ) {
							var tr = $( '#packagesTable>tbody tr.active' )[0];
							var rowData = $( '#packagesTable' ).dataTable().fnGetData( tr );
							if ( confirm( "¿Seguro que desea eliminar '" + rowData.name + "' ?" )) {

							}
						},
						"fnSelect": function ( nButton, oConfig, nRow ) {
							if ( nRow.length == 0 ) return;
							if ( $( nRow ).hasClass( 'active' )) {
								$( nButton ).removeAttr( 'disabled' );
							} else {
								$( nButton ).attr( 'disabled', 'true');
							}
						}
					},
					{
						"sExtends": "text",
						"sButtonText": "Editar",
						"fnInit": function ( nButton, oConfig ) {
							var button = $( nButton );
							button.attr( 'disabled', 'true');
							button.attr( 'data-toggle', 'modal' );
							button.attr( 'href', '#myModal' );
							button.addClass( 'btn' );
							button.addClass( 'btn-primary' );
						},
						"fnClick": function ( nButton, oConfig, oFlash ) {
							var tr = $( '#packagesTable>tbody tr.active' )[0];
							var rowData = $( '#packagesTable' ).dataTable().fnGetData( tr );
							$( '.modal-body' ).html( getForm( rowData ) );
							$( '.modal-title' ).html( 'Editar Software' );
						},
						"fnSelect": function ( nButton, oConfig, nRow ) {
							if ( nRow.length == 0 ) return;
							if ( $( nRow ).hasClass( 'active' )) {
								$( nButton ).removeAttr( 'disabled' );
							} else {
								$( nButton ).attr( 'disabled', 'true');
							}
						}
					}
					],
					"fnRowSelected": function( nodes ) {
						$( '.glyphicon', nodes ).addClass( 'glyphicon-ok' );
					},
					"fnRowDeselected": function( nodes ) {
						$( '.glyphicon', nodes ).removeClass( 'glyphicon-ok' );
					},
					"sSelectedClass": "active"
				},
				"fnServerData": function ( sSource, aoData, fnCallback ) {
					$.getJSON( sSource, aoData, function ( json ) { 
						fnCallback({ "aaData": json });
					}).complete( function(){
						$( packagesTable.fnGetNodes() ).children( 'td.description_tooltip' ).tooltip({
							container: "table",
							animated: true,
							title: $(this).text,
							placement: "bottom",
							trigger: "hover"
						});
					});
				},
				"sAjaxSource": "../php/packages.php?command=list",
				"bAutoWidth": true,
				"bProcessing": true,
				"aoColumns": [
				{
					"mData": "id",
					"bVisible": false
				},
				{ 
					"mData":"name",
					"mRender": function( data, type, full ) {
						return '<span class="glyphicon">  '+data+'</span>';
					},
					"sTitle": "Nombre",
					"sClass": "left"
				},
				{ "mData": "os","sTitle": "Sistema Operativo", "sClass": "center" },
				{ "mData": "arch", "sTitle": "Arquitectura", "sClass": "center"	},
				{ "mData": "version", "sTitle": "Version", "sClass": "center" },
				{ 
					"mData": "description",
					"sTitle": "Descripción",
					"sClass": "left description_tooltip"
				}
				]
			});
	    

    	    $( '#myModal' ).on( 'shown.bs.modal', function() {
    	    	$( '.nav-tabs' ).on( 'click', 'a', function( e ) {
    	    		e.preventDefault();
    	    		if (! $( this ).hasClass( 'add-tab' )) {
    	    			$( this ).tab( 'show' );
    	    		} else {
    	    			var htmlContent = getFormArchSection( gdata );
    	    			htmlContent += getFormOSSection( gdata );
    	    			htmlContent += getFormFileUploadSection( gdata );
    	    			htmlContent += getFormInstallerArgsSection( gdata);
    	    			htmlContent += getFormVersionSection( gdata);

    	    			var count = $( '.nav-tabs' ).children().length;
    	    			$( this ).closest( 'li' ).before( '<li><a id="installer_' + count + '" data-toggle="tab" href="#instref' + count + '">Instalador ' + count + '</li>');
    	    			$( '.tab-content' ).append( '<div class="tab-pane" id="instref' + count + '">' + htmlContent + '</div>' );
    	    			$( '#installer_' + count ).tab('show');
    	    		}
    	    	});
    	    	$( '.add-tab' ).click();
    	    	$( '#myTab a:first').tab('show');
    	    });
    	});

        
		</script>
	</head>

	<body>
		
		<div id="myModal" data-backdrop="static" data-keyboard="false" class="modal fade">
			<div  class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title"></h4>
					</div>
					<div class="modal-body">
					</div>

					<div class="modal-footer">
						<button id="close-dialog-button" type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->

		<div class="panel panel-primary">
			<div class="panel-heading">
				<h4 class="panel-title" data-toggle="collapse" data-target="#packagesTable-div" onclick="toggleShadeIcon(this);">
					<span class="glyphicon glyphicon-th-large"> Programas disponibles</span>
					<span class="glyphicon glyphicon-chevron-down pull-right"></span>
				</h4>
			</div>
			<table id="packagesTable" class="table table-striped table-bordered" style="table-layout:fixed"></table>
			<div class="panel-footer">
				<span class="glyphicon glyphicon-info-sign" > Agregue, modifique y elimine programas.</span>
			</div>
		</div>
	</div>
	</body>
	
	</html>
